<!DOCTYPE html>
<html>
<head>
<title>Tunexa Dashboard</title>
<style>
body{background:#667eea;color:white;font-family:Arial;padding:20px}
.box{background:rgba(255,255,255,0.2);padding:20px;margin:10px;border-radius:10px}
.btn{background:rgba(255,255,255,0.3);color:white;padding:10px;border:none;border-radius:5px;cursor:pointer;margin:5px}
.btn:hover{background:rgba(255,255,255,0.5)}
</style>
</head>
<body>

<h1>üéµ Tunexa Dashboard</h1>
<p>Intelligent Audio Engine</p>

<div class="box">
<h2>System Status: <span id="status">Loading...</span></h2>
<button class="btn" onclick="checkHealth()">Check Health</button>
</div>

<div class="box">
<h3>üéØ Audio Certification</h3>
<button class="btn" onclick="testCert()">Test Certification</button>
<div id="certResult"></div>
</div>

<div class="box">
<h3>üîå OEM Integration</h3>
<button class="btn" onclick="testOEM()">Test Connection</button>
<div id="oemResult"></div>
</div>

<div class="box">
<h3>üìä Quick Links</h3>
<a href="/" target="_blank" style="color:white;text-decoration:none;">üè† API Root</a> |
<a href="/api/health" target="_blank" style="color:white;text-decoration:none;">üíö Health</a> |
<a href="/cars" style="color:white;text-decoration:none;">üöó Cars Browser</a> |
<a href="/speakers" style="color:white;text-decoration:none;">üéôÔ∏è Speakers Manager</a> |
<a href="/api/status" target="_blank" style="color:white;text-decoration:none;">üìä Status</a>
</div>

<div class="box">
<h3>üéµ Test Live API</h3>
<button class="btn" onclick="testCarList()">List Cars (119)</button>
<button class="btn" onclick="testComparison()">Compare Vehicles</button>
<div id="apiResult" style="margin-top:10px;font-size:12px;max-height:300px;overflow:auto;"></div>
</div>

<script>
async function testCarList() {
  document.getElementById('apiResult').innerHTML = 'Loading...';
  try {
    const res = await fetch(`${API_BASE}/api/cars`);
    const data = await res.json();
    const cars = data.cars.slice(0, 5);
    let html = `<div style="background:rgba(0,255,0,0.2);padding:10px;border-radius:5px">`;
    html += `<strong>‚úÖ Total Cars:</strong> ${data.count}<br><br>`;
    html += `<strong>First 5 cars:</strong><br>`;
    cars.forEach(car => {
      html += `‚Ä¢ ${car.brand} ${car.name} (${car.audio?.speakers || 'N/A'} speakers)<br>`;
    });
    html += '</div>';
    document.getElementById('apiResult').innerHTML = html;
  } catch(e) {
    document.getElementById('apiResult').innerHTML = 
      `<div style="background:rgba(255,0,0,0.2);padding:10px;border-radius:5px">‚ùå Error: ${e.message}</div>`;
  }
}

async function testComparison() {
  document.getElementById('apiResult').innerHTML = 'Comparing...';
  try {
    const res = await fetch(`${API_BASE}/api/compare?car1=bmw-3-series&car2=mercedes-benz-e-class`);
    const data = await res.json();
    let html = `<div style="background:rgba(0,255,0,0.2);padding:10px;border-radius:5px">`;
    html += `<strong>‚úÖ Comparison Results:</strong><br><br>`;
    html += `<strong>${data.car1?.brand} ${data.car1?.name}</strong> vs <strong>${data.car2?.brand} ${data.car2?.name}</strong><br><br>`;
    html += `Performance: ${data.comparison?.performance?.horsepower || 'N/A'}<br>`;
    html += `Price: ${data.comparison?.price || 'N/A'}<br>`;
    html += `Audio Score: ${data.comparison?.audio?.score || 'N/A'}`;
    html += '</div>';
    document.getElementById('apiResult').innerHTML = html;
  } catch(e) {
    document.getElementById('apiResult').innerHTML = 
      `<div style="background:rgba(255,0,0,0.2);padding:10px;border-radius:5px">‚ùå Error: ${e.message}</div>`;
  }
}
</script>

<script>
// Auto-detect API base URL (works in Codespaces and localhost)
const API_BASE = window.location.origin;

async function checkHealth() {
  try {
    const res = await fetch(`${API_BASE}/api/health`);
    const data = await res.json();
    document.getElementById('status').innerHTML = '‚úÖ ' + data.status.toUpperCase();
    document.getElementById('status').style.color = '#00ff00';
  } catch(e) {
    document.getElementById('status').innerHTML = '‚ùå Error: ' + e.message;
    document.getElementById('status').style.color = '#ff0000';
  }
}

async function testCert() {
  document.getElementById('certResult').innerHTML = 'Testing...';
  try {
    const res = await fetch(`${API_BASE}/api/certify/bmw-3-series`);
    const data = await res.json();
    document.getElementById('certResult').innerHTML = 
      '<div style="background:rgba(0,255,0,0.2);padding:10px;border-radius:5px;margin-top:10px">' +
      '<strong>‚úÖ Status:</strong> ' + data.status + '<br>' +
      '<strong>Score:</strong> ' + data.score + '<br>' +
      '<strong>Certificate:</strong> ' + data.certificateId + '<br>' +
      '<strong>Vehicle:</strong> ' + data.carName +
      '</div>';
  } catch(e) {
    document.getElementById('certResult').innerHTML = 
      '<div style="background:rgba(255,0,0,0.2);padding:10px;border-radius:5px;margin-top:10px">' +
      '‚ùå Error: ' + e.message +
      '</div>';
  }
}

async function testOEM() {
  document.getElementById('oemResult').innerHTML = 'Connecting...';
  try {
    const res = await fetch(`${API_BASE}/api/oem-integration/connect`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({protocol: 'CAN-FD'})
    });
    const data = await res.json();
    document.getElementById('oemResult').innerHTML = 
      '<div style="background:rgba(0,255,0,0.2);padding:10px;border-radius:5px;margin-top:10px">' +
      '<strong>‚úÖ Connected:</strong> ' + data.connected + '<br>' +
      '<strong>Protocol:</strong> ' + data.protocol + '<br>' +
      '<strong>Device ID:</strong> ' + data.deviceId +
      '</div>';
  } catch(e) {
    document.getElementById('oemResult').innerHTML = 
      '<div style="background:rgba(255,0,0,0.2);padding:10px;border-radius:5px;margin-top:10px">' +
      '‚ùå Error: ' + e.message +
      '</div>';
  }
}

// Auto-check health on load
setTimeout(checkHealth, 500);
</script>

</body>
</html>